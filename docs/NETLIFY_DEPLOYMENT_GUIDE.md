# Netlify Deployment Guide

## Meeting Scheduler App - Client + Server Architecture

---

## 🏗️ Architecture Overview

**Client (React + Vite)** → Netlify
**Server (Node.js + GraphQL)** → Railway/Render/Vercel

---

## 📋 Step-by-Step Deployment Checklist

### 1. 🔐 Netlify Account Setup

- [ ] Visit [https://app.netlify.com/](https://app.netlify.com/)
- [ ] Sign up/Login with GitHub account
- [ ] Connect your GitHub repository: `meeting-schedule-apps`
- [ ] Grant Netlify access to your repositories

### 2. 🛠️ Client Build Preparation

#### Check Build Configuration

```bash
cd client
npm run build
```

#### Verify Vite Config for Production

```javascript
// client/vite.config.ts should have:
export default defineConfig({
  build: {
    outDir: 'dist',
    sourcemap: false, // Set to false for production
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom', 'react-router-dom'],
          apollo: ['@apollo/client', 'graphql'],
          forms: ['react-hook-form', '@hookform/resolvers', 'zod'],
          // ... other chunks
        },
      },
    },
  },
});
```

### 3. 🌍 Environment Variables Setup

#### Client Environment Variables

Create these in Netlify Dashboard → Site Settings → Environment Variables:

```env
VITE_GRAPHQL_URI=https://your-server-domain.com/graphql
VITE_APP_TITLE=Meeting Scheduler
VITE_ENVIRONMENT=production
```

#### Local .env.production file

```env
# client/.env.production
VITE_GRAPHQL_URI=https://your-server-domain.com/graphql
VITE_APP_TITLE=Meeting Scheduler
VITE_ENVIRONMENT=production
```

### 4. 🚀 Server Deployment Options

#### Option A: Railway (Recommended)

```bash
# Install Railway CLI
npm install -g @railway/cli

# Deploy server
cd server
railway login
railway init
railway up
```

#### Option B: Render

- Go to [render.com](https://render.com)
- Connect GitHub repository
- Create new Web Service
- Build Command: `cd server && npm install`
- Start Command: `cd server && npm start`

#### Option C: Vercel Serverless

```bash
# Install Vercel CLI
npm install -g vercel

# Deploy server
cd server
vercel
```

### 5. ⚙️ Netlify Build Settings

#### Site Configuration

1. **Site Settings** → **Build & Deploy**
2. **Build Settings**:
   - **Base directory**: `client`
   - **Build command**: `npm run build`
   - **Publish directory**: `client/dist`

#### Package.json Build Scripts

Ensure your client package.json has:

```json
{
  "scripts": {
    "build": "tsc -b && vite build",
    "build:netlify": "npm ci && npm run build"
  }
}
```

### 6. 🔄 SPA Redirects Configuration

#### Create netlify.toml

```toml
# client/netlify.toml
[build]
  base = "client"
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "22.14.0"

# SPA Redirect for React Router
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# API Proxy (if server on different domain)
[[redirects]]
  from = "/graphql/*"
  to = "https://your-server-domain.com/graphql/:splat"
  status = 200
  force = true

# Security Headers
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"

# Cache Static Assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
```

### 7. 🌐 Domain & SSL Configuration

#### Custom Domain Setup

1. **Site Settings** → **Domain Management**
2. **Add Custom Domain**: `yourdomain.com`
3. **DNS Configuration**:

   ```
   Type: CNAME
   Name: www
   Value: your-site-name.netlify.app

   Type: A
   Name: @
   Value: 75.2.60.5 (Netlify's IP)
   ```

4. **SSL Certificate**: Auto-generated by Netlify

### 8. ⚡ Performance Optimizations

#### Netlify Features to Enable

- [ ] **Asset Optimization**: Auto-compress images
- [ ] **Pretty URLs**: Remove .html extensions
- [ ] **Prerendering**: For better SEO
- [ ] **Analytics**: Track site performance
- [ ] **Split Testing**: A/B test features

#### Edge Functions (Optional)

```javascript
// netlify/edge-functions/api-cache.js
export default async (request, context) => {
  const response = await context.next();

  if (request.url.includes('/graphql')) {
    response.headers.set('Cache-Control', 'max-age=300');
  }

  return response;
};
```

### 9. 🔄 CI/CD Pipeline Setup

#### Automatic Deployments

1. **Build Settings** → **Continuous Deployment**
2. **Branch Deploys**:
   - **Production Branch**: `main`
   - **Deploy Previews**: Enable for pull requests
   - **Branch Deploys**: Enable for `develop` branch

#### GitHub Actions Integration (Optional)

```yaml
# .github/workflows/netlify-deploy.yml
name: Netlify Deploy

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.14.0'
          cache: 'npm'
          cache-dependency-path: 'client/package-lock.json'

      - name: Install dependencies
        run: cd client && npm ci

      - name: Build
        run: cd client && npm run build
        env:
          VITE_GRAPHQL_URI: ${{ secrets.VITE_GRAPHQL_URI }}

      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v2.0
        with:
          publish-dir: './client/dist'
          production-branch: main
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
```

### 10. 🧪 Testing & Validation

#### Pre-Deployment Tests

```bash
# Client build test
cd client
npm run build
npx serve dist -p 3000

# Check all routes work
curl http://localhost:3000/
curl http://localhost:3000/calendar
curl http://localhost:3000/dashboard
```

#### Post-Deployment Tests

- [ ] Test all routes and navigation
- [ ] Verify API connectivity to server
- [ ] Check authentication flow
- [ ] Test responsive design on mobile
- [ ] Validate SSL certificate
- [ ] Check page load performance

---

## 🚨 Common Issues & Solutions

### Build Failures

```bash
# Clear cache and rebuild
rm -rf client/node_modules client/dist
cd client && npm install && npm run build
```

### Environment Variables Not Working

- Ensure variables start with `VITE_`
- Check Netlify dashboard → Environment Variables
- Restart builds after changes

### SPA Routes 404ing

- Verify `netlify.toml` redirects are configured
- Check React Router `basename` configuration

### API Connection Issues

- Verify `VITE_GRAPHQL_URI` points to deployed server
- Check CORS settings on server
- Test API endpoint directly

---

## 📊 Performance Monitoring

### Netlify Analytics

- Enable in Site Settings → Analytics
- Monitor page views, bandwidth usage
- Track Core Web Vitals

### External Monitoring

- **Lighthouse CI**: Automated performance testing
- **Sentry**: Error tracking and monitoring
- **Google Analytics**: User behavior tracking

---

## 🔗 Useful Resources

- [Netlify Documentation](https://docs.netlify.com/)
- [Vite Deployment Guide](https://vitejs.dev/guide/static-deploy.html)
- [React Router Deployment](https://reactrouter.com/en/main/routers/create-browser-router)
- [Railway Deployment](https://railway.app/docs)
- [Render Deployment](https://render.com/docs)

---

**Next Steps**: Start with Step 1 (Netlify Account Setup) and work through each checklist item systematically.
